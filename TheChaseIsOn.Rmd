---
title: "The Chase"
author: "Adam J Campbell"
date: "04/09/2020"
output: html_document
---

```{r}
library(rvest)
library(tidyverse)
library(stringi)
```

```{r}
url <- "http://onequestionshootout.xyz/players/series_all.htm"

players <- url %>%
  xml2::read_html() %>%
  html_nodes("table") %>%
  .[2] %>%
  html_table(fill = TRUE)

data <- players [[1]]
```


```{r}



test<-data %>%
  mutate(CashBuilder = parse_number(CashBuilder)) %>%
  
  mutate(ChosenOffer = str_replace(ChosenOffer, "=", "")) %>%
  mutate(ChosenOffer = str_replace(ChosenOffer, "/", "")) %>%
  mutate(ChosenOffer = str_replace(ChosenOffer, "£", "")) %>%
  mutate(ChosenOffer = gsub("([\\])", "", ChosenOffer) ) %>%
  mutate(ChosenOffer = parse_number(ChosenOffer)) %>%
  
  mutate(LowerOffer = str_replace(LowerOffer, "£", "")) %>%
  mutate(LowerOffer = parse_number(LowerOffer)) %>%

  mutate(HigherOffer = parse_number(HigherOffer)) %>%
  
  mutate(HTHResult = parse_number(HTHResult)) %>%

  mutate(FC_Correct_Answers_Player = stri_extract_first_regex(`FC CorrectAnswers`,"[0-9]+")) %>%
  
  mutate(FC_team_size = case_when(grepl("solo", `FC CorrectAnswers`, fixed = TRUE) == TRUE ~ "1",
                                        grepl("solo", `FC CorrectAnswers`, fixed = TRUE) == FALSE ~ stri_extract_last_regex(`FC CorrectAnswers`,"[0-9]+")
                                        )
         ) %>%
  
  mutate(
    FC_Winner = case_when(
      grepl("Chaser", `FC Winner`, fixed = TRUE) == TRUE ~ "Chaser",
      grepl("Chaser", `FC Winner`, fixed = TRUE) == FALSE ~ "Team"
      )
    ) %>%
  mutate(
    Team_Win_Amount = case_when(
      FC_Winner == "Team" ~ stri_extract_last_regex(`FC Winner`,"[0-9]+")
    )
  ) %>%
  
  mutate(
    Chaser_Win_Amount = case_when(
      FC_Winner == "Chaser" ~ stri_extract_last_regex(`FC Winner`,"[0-9]:[0-9]+")
    )
  ) %>%
  
  mutate(
    Special_round = case_when(
      grepl("✝", `FC CorrectAnswers`, fixed = TRUE) == TRUE ~ TRUE,
      grepl("✝", `FC CorrectAnswers`, fixed = TRUE) == FALSE ~ FALSE,
    )
  ) %>%
  
  mutate(`Amount WonBy Player`= parse_number(`Amount WonBy Player`))


test$Date <- as.Date(test$Date,"%d/%m/%Y")
```

Things I need to do next:
- get rid of columns you don't need
- calc total correct answers for each team
